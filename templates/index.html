<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Education Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
<div class="container">
    <h1>EDUCATION SUMMARY</h1>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
        {% for message in messages %}
          <li style="color:green;">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    <form id="summaryForm" method="post" enctype="multipart/form-data">
        <textarea name="summary" rows="4" placeholder="เขียนสรุปเนื้อหาบทเรียนที่นี่..." required></textarea>
        <input type="file" name="image" accept="image/*">
        <button type="submit">บันทึกสรุป</button>
    </form>
    <div id="summaries">
        {% for s in summaries %}
        <div class="summary" id="post-{{s.id}}">
            <div class="summary-text">
                <b>สรุป:</b> {{ s.text|e }}
                {% if s.image %}
                <div class="summary-image">
                    <img src="{{ url_for('static', filename='uploads/' + s.image) }}" alt="แนบรูป">
                </div>
                {% endif %}
            </div>
            <div class="comments">
                <b>ความคิดเห็น:</b>
                {% for c in comment_map.get(s.id, []) %}
                    <div class="comment">{{ c.text|e }}</div>
                {% endfor %}
                <form method="post" action="{{ url_for('comment', summary_id=s.id) }}" class="comment-form">
                    <input type="text" name="comment" placeholder="แสดงความคิดเห็น..." required>
                    <button type="submit">คอมเมนต์</button>
                </form>
            </div>
            <div class="summary-actions">
                <div class="share-link">
                    <a href="{{ url_for('share', summary_id=s.id) }}" target="_blank">
                        <button type="button">แชร์</button>
                    </a>
                </div>
                <form method="post" action="{{ url_for('delete', summary_id=s.id) }}" onsubmit="return confirm('ลบโพสต์นี้?');" style="display:inline;">
                    <button class="delete-btn" type="submit">ลบโพสต์</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
</body>
</html>