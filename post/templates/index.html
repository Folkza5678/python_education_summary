<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Edu-File</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
    <nav class="navbar">
    <div class="logo">
        <img src="{{ url_for('static', filename='edulogo.png') }}" alt="Logo" style="height:35px; vertical-align:middle; margin-right:8px;">
    </div>
    <div class="nav-links">
        <a href="#">
        <img src="{{ url_for('static', filename='home.png') }}" alt="Home" style="height:20px; vertical-align:middle; position: relative; top: -3px; margin-left: -37px;">   
        <span style="position:relative; left: -6px;">HOME</span>
    </a>
        <a href="#">
        <img src="{{ url_for('static', filename='book.png') }}" alt="Subject" style="height:42px; vertical-align:middle; position: relative; margin-left: -37px;">    
        <span style="position:relative; left: -16px;">SUBJECT</span>
    </a>
        <a href="#">
        <img src="{{ url_for('static', filename='set.png') }}" alt="Setting" style="height:20px; vertical-align:middle; position: relative; top: -2px; margin-left: -37px;">    
        <span style="position:relative; left: -5px;">SETTING</span>
    </a>
    </div>
    <div class="user-menu">
        <i class="fa fa-user"></i> UNAME
    </div>    
</nav>
    <div class="container">
    <div class="post-form-container">
        <div class="form-header">
            <i class="fa fa-user"></i> UNAME
        </div>
        <form class="post-form" method="post" enctype="multipart/form-data">
            <textarea id="summary-textarea" name="summary" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ..." required></textarea>
            <div class="file-upload-box">
                <input type="file" id="file-upload" name="file" accept=".pdf,image/*" hidden>
                <label for="file-upload" class="custom-file-label">
                    <img src="{{ url_for('static', filename='z.png') }}" alt="file icon" style="height: 22px; vertical-align: middle; margin-right: -3px;">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                </label>
                <span id="file-name" class="file-name-label">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
            </div>
            <button type="submit">POST</button>
        </form>
    </div>
</div>
<div class="posts">
        {% for post in posts %}
        <div class="post">
            <div class="post-header">
                <span class="post-title">UNAME</span>
            </div>
            <div class="post-content">
                <div class="post-text">{{ post.text|e }}</div>
                {% if post.file %}
           <div class="post-file">
    {% if post.file.endswith('.pdf') %}
        <a href="{{ url_for('static', filename='uploads/' + post.file) }}" target="_blank" class="pdf-card">
            <div class="pdf-icon">
                <img src="{{ url_for('static', filename='doc.png') }}" alt=" "style="height:30px; width:30px; vertical-align: middle; margin-right: 1px; margin-top:-1px;">
            </div>
            <div class="pdf-info">
                <p class="pdf-title">{{ post.file }}</p>
            </div>
        </a>
    {% else %}
        <img src="{{ url_for('static', filename='uploads/' + post.file) }}" alt="‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå" class="attached-img">
    {% endif %}
</div>
                {% endif %}
            </div>
<div class="post-card" data-post-id="1">
  <div class="interactions">
    <button class="btn" onclick="likePost(this)">üëç <span class="like-count">0</span></button>
    <button class="btn" onclick="toggleCommentBox(this)">üí¨ <span class="comment-count">0</span></button>
  </div>

  <div class="comment-box hidden">
    <input type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô...">
    <button class="btn btn-primary" onclick="addComment(this)">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
  </div>

  <div class="comment-list"></div>
</div>

        </div>
        {% endfor %}
        
    </div>

<script>
const currentUser = "UNAME";

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
document.querySelectorAll(".post-card").forEach(postCard => {
  const postId = postCard.dataset.postId;

  // ‡πÇ‡∏´‡∏•‡∏î likes
  let likes = JSON.parse(localStorage.getItem("likes_" + postId)) || 0;
  const likeCount = postCard.querySelector(".like-count");
  likeCount.innerText = likes;

  // ‡πÇ‡∏´‡∏•‡∏î comments
  const savedComments = JSON.parse(localStorage.getItem("comments_" + postId)) || [];
  const commentList = postCard.querySelector(".comment-list");
  const commentCount = postCard.querySelector(".comment-count");
  commentCount.innerText = savedComments.length;

  savedComments.forEach(text => {
    const p = document.createElement("p");
    p.className = "comment";
    p.innerHTML = `<b>${currentUser}:</b> <span class="comment-text">${text}</span>`;
    commentList.appendChild(p);
  });
});

// toggle ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á comment
function toggleCommentBox(button) {
  const postCard = button.closest(".post-card");
  const commentBox = postCard.querySelector(".comment-box");
  const commentList = postCard.querySelector(".comment-list");

  // toggle input box
  commentBox.classList.toggle("hidden");

  // toggle list ‡∏î‡πâ‡∏ß‡∏¢
  if (commentList.style.display === "none" || commentList.style.display === "") {
    commentList.style.display = "block";
  } else {
    commentList.style.display = "none";
  }
}

// ‡∏Å‡∏î‡πÑ‡∏•‡∏Ñ‡πå
function likePost(button) {
  const postCard = button.closest(".post-card");
  const postId = postCard.dataset.postId;
  const likeCount = button.querySelector(".like-count");
  let count = parseInt(likeCount.innerText) || 0;

  if (button.classList.contains("liked")) {
    count--;
    button.classList.remove("liked");
  } else {
    count++;
    button.classList.add("liked");
  }

  likeCount.innerText = count;
  localStorage.setItem("likes_" + postId, count);
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå
function addComment(button) {
  const postCard = button.closest(".post-card");
  const postId = postCard.dataset.postId;
  const input = postCard.querySelector("input");
  const text = input.value.trim();
  if (text === "") return;

  const commentList = postCard.querySelector(".comment-list");
  const p = document.createElement("p");
  p.className = "comment";
  p.innerHTML = `<b>${currentUser}:</b> <span class="comment-text">${text}</span>`;
  commentList.appendChild(p);

  input.value = "";

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå
  const commentCount = postCard.querySelector(".comment-count");
  let count = parseInt(commentCount.innerText) || 0;
  count++;
  commentCount.innerText = count;

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
  const saved = JSON.parse(localStorage.getItem("comments_" + postId)) || [];
  saved.push(text);
  localStorage.setItem("comments_" + postId, JSON.stringify(saved));

  // ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå list ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà
  commentList.style.display = "block";
}
</script>
</body>
</html>