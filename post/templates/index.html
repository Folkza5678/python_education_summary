<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Edu-File</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
    <nav class="navbar">
    <div class="logo">
        <img src="{{ url_for('static', filename='edulogo.png') }}" alt="Logo" style="height:35px; vertical-align:middle; margin-right:8px;">
    </div>
    <div class="nav-links">
        <a href="#">
        <img src="{{ url_for('static', filename='home.png') }}" alt="Home" style="height:20px; vertical-align:middle; position: relative; top: -3px; margin-left: -37px;">   
        <span style="position:relative; left: -6px;">HOME</span>
    </a>
        <a href="#">
        <img src="{{ url_for('static', filename='book.png') }}" alt="Subject" style="height:42px; vertical-align:middle; position: relative; margin-left: -37px;">    
        <span style="position:relative; left: -16px;">SUBJECT</span>
    </a>
        <a href="#">
        <img src="{{ url_for('static', filename='set.png') }}" alt="Setting" style="height:20px; vertical-align:middle; position: relative; top: -2px; margin-left: -37px;">    
        <span style="position:relative; left: -5px;">SETTING</span>
    </a>
    </div>
    <div class="user-menu">
        <i class="fa fa-user"></i> UNAME
    </div>    
</nav>
    <div class="container">
    <div class="post-form-container">
        <div class="form-header">
            <i class="fa fa-user"></i> UNAME
        </div>
        <form class="post-form" method="post" enctype="multipart/form-data">
            <textarea id="summary-textarea" name="summary" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ..." required></textarea>
            <div class="file-upload-box">
                <input type="file" id="file-upload" name="file" accept=".pdf,image/*" hidden>
                <label for="file-upload" class="custom-file-label">
                    <img src="{{ url_for('static', filename='z.png') }}" alt="file icon" style="height: 22px; vertical-align: middle; margin-right: -3px;">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                </label>
                <span id="file-name" class="file-name-label">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
            </div>
            <button type="submit">POST</button>
        </form>
    </div>
</div>
<div class="posts">
        {% for post in posts %}
        <div class="post">
            <div class="post-header">
                <span class="post-title">UNAME</span>
            </div>
            <div class="post-content">
                <div class="post-text">{{ post.text|e }}</div>
                {% if post.file %}
           <div class="post-file">
    {% if post.file.endswith('.pdf') %}
        <a href="{{ url_for('static', filename='uploads/' + post.file) }}" target="_blank" class="pdf-card">
            <div class="pdf-icon">
                <img src="{{ url_for('static', filename='doc.png') }}" alt=" "style="height:30px; width:30px; vertical-align: middle; margin-right: 1px; margin-top:-1px;">
            </div>
            <div class="pdf-info">
                <p class="pdf-title">{{ post.file }}</p>
            </div>
        </a>
    {% else %}
        <img src="{{ url_for('static', filename='uploads/' + post.file) }}" alt="‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå" class="attached-img">
    {% endif %}
</div>
                {% endif %}
            </div>
<div class="post-card">
  <div class="interactions">
    <button class="btn" onclick="likePost(this)">üëç <span class="count">0</span></button>
    <button class="btn">üí¨ <span class="count">0</span></button>
  </div>
   <div class="comment-box">
      <input type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô...">
      <button class="btn btn-primary" onclick="addComment(this)">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
  </div>
  <div class="comment-list"></div>
</div>
        </div>
        {% endfor %}
        
    </div>

<script>
const textarea = document.getElementById('summary-textarea');
textarea.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});
document.getElementById('file-upload').addEventListener('change', function() {
    const fileName = this.files[0] ? this.files[0].name : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
    const icon = `<img src="{{ url_for('static', filename='q.png') }}" alt="file icon" style="height: 30px; vertical-align: middle; margin-right: -3px;">`;
    document.getElementById('file-name').innerHTML = fileName !== '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'
        ? icon + '<b>' + fileName + '</b>'
        : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
});

 // ----------------------------
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö (Like, View, Comment)
// ----------------------------

// ‡∏Å‡∏î‡πÑ‡∏•‡∏Å‡πå
function likePost(button) {
  const countSpan = button.querySelector(".count");
  let count = parseInt(countSpan.innerText);

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  if (button.classList.contains("liked")) {
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏•‡∏Ñ‡πå
    countSpan.innerText = count - 1;
    button.classList.remove("liked");
  } else {
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏î ‚Üí ‡πÑ‡∏•‡∏Ñ‡πå
    countSpan.innerText = count + 1;
    button.classList.add("liked");
  }
}
const currentUser = "UNAME";

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏à‡∏≤‡∏Å localStorage ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
document.querySelectorAll(".post-card").forEach(postCard => {
  const postId = postCard.dataset.postId;
  const commentList = postCard.querySelector(".comment-list");
  const commentCount = postCard.querySelector(".comment-count");

  const saved = JSON.parse(localStorage.getItem("comments_" + postId)) || [];
  saved.forEach(text => {
    const p = document.createElement("p");
    p.className = "comment";
    p.innerHTML = `<b>${currentUser}:</b> ${text}`;
    commentList.appendChild(p);
  });
  commentCount.innerText = saved.length;
});

function addComment(button) {
  const postCard = button.closest(".post-card");
  const postId = postCard.dataset.postId;
  const input = postCard.querySelector("input");
  const text = input.value.trim();
  if (text === "") return;

  const commentList = postCard.querySelector(".comment-list");

  const p = document.createElement("p");
  p.className = "comment";
  p.innerHTML = `<b>${currentUser}:</b> ${text}`;
  commentList.appendChild(p);

  input.value = "";

  const commentCount = postCard.querySelector(".comment-count");
  let count = parseInt(commentCount.innerText) || 0;
  commentCount.innerText = count + 1;

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
  const saved = JSON.parse(localStorage.getItem("comments_" + postId)) || [];
  saved.push(text);
  localStorage.setItem("comments_" + postId, JSON.stringify(saved));
}
</script>
</body>
</html>